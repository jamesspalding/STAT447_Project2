---
title: "Project 2"
author: "James Spalding, Ryan Winder"
date: "2024-04-13"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, include = F)

#Libraries
library(tidyverse)
library(readxl)
library(DescTools)
library(gt)
library(gtExtras)
library(gridExtra)
library(ggpubr)
library(boot)
```

```{r}
data = read.csv("CervicalCancer.csv") %>% select(-"STDs.AIDS") #None of the patients had AIDS

#split to positive and negative
positiveData = data %>%
  filter(Biopsy == 1)

negativeData = data %>%
  filter(Biopsy == 0)
```

## Introduction

Cervical cancer is a disease that affects around 200,000 women per year in the United States. It has minor symptoms and is difficult to detect without a screening. However, according to *American Cancer Society*, if detected early, cervical cancer is one of the most successfully treatable cancers with over an 80% survival rate if detected in its first year. 

For this reason, the main goal of our study is to determine which lifestyle and sexual factors significantly contribute to the presence of cervical cancer in patients so they can get timely screenings and treatment.

## Exploring the Data

```{r, include = T}
##### Summary Stats Table #####

Term       = c("Age",
               "Number of sexual partners",
               "Age of first sexual intercourse", 
               "Number of Pregnancies",
               "Smoke",
               "Years of Smoking",
               "Packs Smoked/Year",
               "Hormonal Contraceptives", 
               "Years used Hormonal Contraceptives",
               "IUD",
               "Years used IUD",
               "Has had STD",
               "Condylomatosis", 
               "Syphilis",
               "Pelvic Inflammatory Disease",
               "Genital Herpes",
               "Molluscum Contagiosum",
               "HIV",
               "Hepatitis B",
               "HPV",
               "Positive for Cervical Cancer")

Ratio = c()
Count = c()
Mean = c()
Min = c()
Max = c()
SD = c()

#Obtain descriptive stats
for(i in names(data)){
  #Determine if percent or mean is applicable
  if (length(unique(data[[i]])) == 2){
    Ratio = c(Ratio, paste0(round(mean(data[[i]]),4) * 100, "%"))
    Count = c(Count, length(which(data[[i]] == 1)))
    Mean  = c(Mean, "")
    Min   = c(Min, "")
    Max   = c(Max, "")
    SD    = c(SD, "")
  }else{
    Ratio = c(Ratio, "")
    Count = c(Count, "")
    Mean  = c(Mean, round(mean(data[[i]]),2))
    Min   = c(Min, min(data[[i]]))
    Max   = c(Max, max(data[[i]]))
    SD    = c(SD, round(sd(data[[i]]),2))
  }
}

#Decided to split into 2 types for better presentation...

#Binary variables
binTerm = Term[c(5,8,10,12:21)]
Percentage = Ratio[c(5,8,10,12:21)]
Count = Count[c(5,8,10,12:21)]

#Quantitative variables
quantTerm = c(Term[c(1:4, 6,7,9)], rep("",6))
Mean = c(Mean[c(1:4, 6,7,9)], rep("",6))
Min  = c(Min[c(1:4, 6,7,9)], rep("",6))
Max  = c(Max[c(1:4, 6,7,9)], rep("",6))
SD   = c(SD[c(1:4, 6,7,9)], rep("",6))


records = as.data.frame(t(as.data.frame(rbind(binTerm, Count, Percentage,
                                              quantTerm, Mean, Min, Max, SD))))

records %>%
  gt() %>%
  gt_theme_nytimes() %>%
  tab_header(title="Table 1: Variables explained.") %>%
  tab_spanner(label="Binary Terms", columns = c(binTerm, Count, Percentage)) %>%
  tab_spanner(label="Quantitative Terms", columns = c(quantTerm, Mean, Min, Max, SD)) %>%
  cols_label(binTerm = " ", quantTerm = " ")
```

In our study, there are a total of 647 patients; 24 are positive for cervical cancer, or around 4%. A few noteworthy statistics in *table 1* are that the mean age of patients is around 27 years old, around 65% have used hormonal contraceptives for a mean of 2.25 years, and around 9% have had some sort of STD with HIV being the most common at an overall percentage of 1.85%. Using this information, we are able to perform various tests to determine which of these variables are significant to the presence of cervical cancer.

## Statistical Methods

*All analysis conducted in R 4.2.2*

Because of the very small percentage of positive patients, all analysis will be conducted using nonparametric methods.

*Perm tests for significance* 

*fisher's test for qualitative,*


```{r}
#bootstrap and perm tests for differences?


```

```{r}
#bootstrap for multi reg
obs.mod = lm(Biopsy~., data = data)


e = obs.mod$residuals
modsummary = summary(obs.mod)

fObs = modsummary$fstatistic[1]
tObs = c()
for(i in 2:21){
  tObs = c(tObs, modsummary$coefficients[i,3])
}

bootData = data %>%
  select(-Biopsy) ; bootData$e = rep(999, 647)

nboot=1000
tBoot = array(dim = c(20,1,nboot))
fBoot = c()
for (i in 1:nboot){
  eboot = sample(e,replace=TRUE)
  bootData$e = eboot
  
  boot.mod = lm(e~., data=bootData)
  modsummaryP=summary(boot.mod)

  for(j in 2:21){
    tBoot[j-1,1,i] = modsummary$coefficients[j,3]
  }
  
  fBoot = c(fBoot,modsummaryP$fstatistic[1])
}

#Overall test
sum(fBoot>=fObs)/nboot #.03 that at least 1 is significant

#Individual tests
for(i in 1:20){
  if(sum(abs(tBoot[i,,])>=abs(tObs))/nboot < .06){
    print(names(data)[i])
    print(sum(abs(tBoot[i,,])>=abs(tObs))/nboot)
  }
}

#Only STDs.molluscum.contagiosum appears significant. Maybe dont include this.
```

## Results and Conclusion

*Describe results from tests*

*Explain what the results mean/conclude*